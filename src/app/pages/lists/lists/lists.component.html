<div class="top-section">
    <form (submit)="createNewList()" #f="ngForm">
        <mat-input-container>
            <input matInput type="text" name="listname" placeholder="{{'List_name' | translate}}"
                   [formControl]="newListFormControl" required>
            <mat-error
                *ngIf="newListFormControl.hasError('required')">
                {{'Please_enter_a_name' | translate}}
            </mat-error>
        </mat-input-container>
        <button type="submit" mat-raised-button color="accent">{{'Add_a_list' | translate}}</button>
    </form>

    <div class="spacer"></div>

    <button mat-button color="accent" (click)="regenerateAllLists()" class="regenerate-all-button">
        <mat-icon>update</mat-icon>
        {{"LISTS.Regenerate_all" | translate}}
    </button>
</div>

<h3 class="mat-h3">{{'Lists' | translate}}</h3>

<div class="filter">
    <mat-form-field>
        <mat-select (selectionChange)="tagFilter.next($event.value)"
                    multiple="true" #tagFilterSelect
                    placeholder="{{'Tag_filter' | translate}}">
            <mat-option *ngFor="let tag of tags" value="{{tag}}">{{"LIST_TAGS."+tag | translate}}</mat-option>
        </mat-select>
    </mat-form-field>
    <button mat-icon-button (click)="tagFilterSelect.value = []; tagFilter.next([])">
        <mat-icon>refresh</mat-icon>
    </button>
</div>

<button mat-icon-button (click)="openMergeListsPopup()" [disabled]="(lists | async)?.length < 2" class="merge-button"
        matTooltip="{{'LISTS.Merge_lists' | translate}}" matTooltipPosition="above">
    <mat-icon>call_merge</mat-icon>
</button>

<div class="lists-container" *ngIf="lists | async as listsData">
    <div class="row" *ngFor="let list of listsData; let i = index">
        <app-list-panel
            [list]="list"
            [expanded]="expanded.indexOf(list.$key) > -1"
            (opened)="opened(list.$key)"
            (closed)="closed(list.$key)"
            (onrecipedelete)="removeRecipe($event.recipe, list, list.$key)"
            (onedit)="updateAmount($event.recipe, list, list.$key, $event.amount)"
            (ondelete)="delete(list)"
            [authorUid]="user.uid"
            [odd]="i%2>0"></app-list-panel>
    </div>
    <div class="workshops">
        <h2>{{'WORKSHOP.Workshops' | translate}}</h2>
        <mat-divider class="divider"></mat-divider>
        <div *ngFor="let workshop of workshops | async">
            <app-workshop-panel [workshop]="workshop"></app-workshop-panel>
        </div>
        <button mat-button (click)="newWorkshop()" class="new-workshop" color="accent">{{'WORKSHOP.Add_workshop' |
            translate}}
        </button>
    </div>
</div>

<div *ngIf="(lists | async) === null && loading" class="loader-container">
    <mat-spinner></mat-spinner>
</div>
